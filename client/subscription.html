

    <div class="content-wrapper">
        <div class="row" id="proBanner">
            <i id="bannerClose"></i>
        </div>
        <div class="page-header">
          <h3 class="page-title">
            <span class="page-title-icon bg-gradient-info text-white mr-2">
              <i class="mdi mdi-book-plus"></i>
            </span> Subscription Status
          </h3>
        </div>

        <div class="row">
          <div class="col-md-7 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <div class="clearfix">
                  <h2 class="card-title float-left">Account Details</h2>
                </div>
                <div class="container">
                  <div class="table-responsive">
                    <table class="table">
                        <tr>
                            <td><h5>Developer Name</h5></td>
                            <td><h5>:</h5></td>
                            <td><h5 ><span id="devNameAccount"></span></h5></td>
                        </tr>
                        <tr>
                            <td><h5>Email</h5></td>
                            <td><h5>:</h5></td>
                            <td><h5><span id="devEmailAccount"></span></h5></td>
                        </tr>
                        <tr>
                            <td><h5>Subscription Type</h5></td>
                            <td><h5>:</h5></td>
                            <td><h5><span id="devSubType"></span></h5></td>
                        </tr>
                        <tr>
                            <td><h5>Subscription Status</h5></td>
                            <td><h5>:</h5></td>
                            <td><h5 class="badge badge-gradient-success"><span id="devSubStat">ACTIVE</span></h5></td>
                        </tr>
                        <tr>
                            <td><h5>Start Date</h5></td>
                            <td><h5>:</h5></td>
                            <td><h5><span id="sDateAcc"></span></h5></td>
                        </tr>
                        <tr>
                            <td><h5>Expiration Date</h5></td>
                            <td><h5>:</h5></td>
                            <td><h5><span id="eDateAcc"></span></h5></td>
                        </tr>
                        <tr>
                            <td><h5>Durations</h5></td>
                            <td><h5>:</h5></td>
                            <td><h5><span id="durAccount"></span></h5></td>
                        </tr>
                    </table>
                  </div>
                </div>
              </div>
              
            </div>
          </div>
          <div class="col-md-5 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <div id="customButton">
                <h4 class="card-title">Account Settings</h4>
                <button id="changePasswordButton" type="button" class="btn btn-outline-info btn-icon-text">
                <i class="mdi mdi-reload btn-icon-prepend"></i>Change Password</button> <br> <br>
                <button type="button" class="btn btn-outline-success btn-icon-text">
                <i class="mdi mdi-book-plus btn-icon-prepend"></i>Extend Subscription</button> <br> <br>
                <button type="button" class="btn btn-outline-danger btn-icon-text">
                    <i class="mdi mdi-email btn-icon-prepend"></i>Give Feedback</button>
                  </div>

                    <div id="formPassword" style="display:none;">
                      <h4 class="card-title">Change Password</h4>
                      <div class="form-group">
                        <form>
                        <input type="password" class="form-control" id="changePassword" placeholder="New Password"> <br>
                      </form>
                      <button type="button" class="btn btn-gradient-primary btn-fw" id="submitNewPassword">Change</button>
                      
                        <div class="spinner-border text-primary" style="display:none;" role="status">
                          <span class="sr-only">Loading...</span>
                        </div>
                    
                      </div>
                    </div>
                    
              </div>
            </div>
          </div>
        </div>
    
        <div class="row">
          <div class="col-md-12 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <h4 class="card-title">Project List</h4>
                <div class="table-responsive">
                  <table class="table">
                    <thead>
                      <tr>
                        <th> # </th>
                        <th> Name </th>
                        <th> Due Date </th>
                        <th> Progress </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td> 1 </td>
                        <td> Herman Beck </td>
                        <td> May 15, 2015 </td>
                        <td>
                          <div class="progress">
                            <div class="progress-bar bg-gradient-success" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td> 2 </td>
                        <td> Messsy Adam </td>
                        <td> Jul 01, 2015 </td>
                        <td>
                          <div class="progress">
                            <div class="progress-bar bg-gradient-danger" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td> 3 </td>
                        <td> John Richards </td>
                        <td> Apr 12, 2015 </td>
                        <td>
                          <div class="progress">
                            <div class="progress-bar bg-gradient-warning" role="progressbar" style="width: 90%" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"></div>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td> 4 </td>
                        <td> Peter Meggik </td>
                        <td> May 15, 2015 </td>
                        <td>
                          <div class="progress">
                            <div class="progress-bar bg-gradient-primary" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td> 5 </td>
                        <td> Edward </td>
                        <td> May 03, 2015 </td>
                        <td>
                          <div class="progress">
                            <div class="progress-bar bg-gradient-danger" role="progressbar" style="width: 35%" aria-valuenow="35" aria-valuemin="0" aria-valuemax="100"></div>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td> 5 </td>
                        <td> Ronald </td>
                        <td> Jun 05, 2015 </td>
                        <td>
                          <div class="progress">
                            <div class="progress-bar bg-gradient-info" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <script>
          $( document ).ready(function() {

            const url = "https://script.google.com/a/pinhome.id/macros/s/AKfycbx1Pal6dF2SDRWSysX9aeXqak4nAoe-G2zg13_FeTC0vDjENgI/exec";
            loadSubscription();

            function loadSubscription(){
              const queryString = window.location.search;
              const urlParams = new URLSearchParams(queryString).get('sessionToken');
              var monthNames = ["January", "February", "March", "April", "May", "June",
                      "July", "August", "September", "October", "November", "December"];


            if(urlParams != null){
                fetch(url+"?retrieveAccount="+urlParams,{
                    method: 'POST',
                    cache: 'no-cache',
                    credentials: 'omit',
                    redirect: 'follow',
                    body: JSON.stringify({token: urlParams})
                })
                .then(d => d.json())
                .then(d => {
                    if(d.status === "TRUE"){
                    var dStart = new Date(d.start_date);
                    var dEnd = new Date(d.expired_date);
                    var dDur = (Math.round(dEnd.getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24 )).toFixed(0) + " Days Remaning";

                    $("#devNameAccount").html(d.name.toUpperCase());
                    $("#devEmailAccount").html(d.email);
                    $("#devSubType").html(d.subs);
                    $("#sDateAcc").html(dStart.getDate() + " " + monthNames[dStart.getMonth()] + " " + dStart.getFullYear());
                    $("#eDateAcc").html(dEnd.getDate() + " " + monthNames[dEnd.getMonth()] + " " + dEnd.getFullYear());
                    $("#durAccount").html(dDur);
                    } else{
                        window.open("login.html","_top");
                    }
                });
            } else {
                window.open("login.html","_top");
            }


            }


            $("#changePasswordButton").click(function(){
              $("#formPassword").show();
              $("#customButton").hide();
            });

            $("#submitNewPassword").click(function(){
              $(".spinner-border").show();
              const queryString = window.location.search;
              const urlParams = new URLSearchParams(queryString).get('sessionToken');

              var email = $("#devEmailAccount").html();
              var pass = CryptoJS.SHA256($("#changePassword").val()).toString();
              var loginToken = email + pass;

              if(urlParams != null){
                fetch(url+"?form=change_password",{
                    method: 'POST',
                    cache: 'no-cache',
                    credentials: 'omit',
                    redirect: 'follow',
                    body: JSON.stringify({token: urlParams, password: pass, new_token: loginToken})
                })
                .then(d => d.json())
                .then(d => {
                    if(d){
                      Swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: 'Email Changed, please Re Login!',
                      });
                      window.open("login.html","_top");
                    } else{
                        window.open("login.html","_top");
                    }
                });
            } else {
                window.open("login.html","_top");
            }

            });
          });
      </script>